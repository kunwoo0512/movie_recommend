<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜í™” ë¹„êµ - {{ original.title }} vs {{ related.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/movie_compare.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-film"></i>
                <span>MovieFinder</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">
                    <i class="fas fa-home"></i>
                    í™ˆìœ¼ë¡œ
                </a>
                <a href="javascript:history.back()" class="nav-link">
                    <i class="fas fa-arrow-left"></i>
                    ë’¤ë¡œê°€ê¸°
                </a>
            </nav>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <div class="container">
                <!-- ë¹„êµ ì œëª© -->
                <div class="compare-header">
                    <h1 class="compare-title">
                        <i class="fas fa-balance-scale"></i>
                        ì˜í™” ìœ ì‚¬ë„ ë¶„ì„
                    </h1>
                    <p class="compare-subtitle">ë‘ ì˜í™”ê°€ ì–´ë–¤ ì ì—ì„œ ìœ ì‚¬í•œì§€ ë¶„ì„í•´ë³´ì„¸ìš”</p>
                </div>

                <!-- ì˜í™” ì •ë³´ ë¹„êµ -->
                <div class="movies-comparison">
                    <!-- ì›ë³¸ ì˜í™” -->
                    <div class="movie-section original">
                        <div class="movie-label">ì›ë³¸ ì˜í™”</div>
                        <div class="movie-card">
                            <div class="movie-poster">
                                {% if original.poster_url %}
                                    <img src="{{ original.poster_url }}" alt="{{ original.title }}" />
                                {% else %}
                                    <div class="poster-placeholder">
                                        <i class="fas fa-film"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="movie-info">
                                <h3 class="movie-title">{{ original.title }}</h3>
                                <p class="movie-year">{{ original.year }}</p>
                                <p class="movie-director">ê°ë…: {{ original.director or 'ì •ë³´ ì—†ìŒ' }}</p>
                                <div class="movie-genres">
                                    {% set original_genres = original.genres.keys() | list if original.genres else [] %}
                                    {% for genre in original_genres[:3] %}
                                        <span class="genre-tag">{{ genre }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VS í‘œì‹œ -->
                    <div class="vs-indicator">
                        <div class="vs-circle">
                            <span>VS</span>
                        </div>
                    </div>

                    <!-- ì¶”ì²œ ì˜í™” -->
                    <div class="movie-section related">
                        <div class="movie-label">ì¶”ì²œ ì˜í™”</div>
                        <div class="movie-card">
                            <div class="movie-poster">
                                {% if related.poster_url %}
                                    <img src="{{ related.poster_url }}" alt="{{ related.title }}" />
                                {% else %}
                                    <div class="poster-placeholder">
                                        <i class="fas fa-film"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="movie-info">
                                <h3 class="movie-title">{{ related.title }}</h3>
                                <p class="movie-year">{{ related.year }}</p>
                                <p class="movie-director">ê°ë…: {{ related.director or 'ì •ë³´ ì—†ìŒ' }}</p>
                                <div class="movie-genres">
                                    {% set related_genres = related.genres.keys() | list if related.genres else [] %}
                                    {% for genre in related_genres[:3] %}
                                        <span class="genre-tag">{{ genre }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìœ ì‚¬ë„ ë¶„ì„ -->
                <div class="similarity-analysis">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        ìœ ì‚¬ë„ ë¶„ì„ ê²°ê³¼
                    </h2>

                    <!-- ìœ ì‚¬ë„ ì ìˆ˜ ì¹´ë“œ -->
                    <div class="similarity-cards">
                        <div class="similarity-card plot">
                            <div class="card-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="card-content">
                                <h3>ì¤„ê±°ë¦¬ ìœ ì‚¬ë„</h3>
                                <div class="score">{{ "%.1f"|format((similarity.plot or 0) * 100) }}%</div>
                            </div>
                        </div>

                        <div class="similarity-card flow">
                            <div class="card-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-content">
                                <h3>íë¦„ê³¡ì„  ìœ ì‚¬ë„</h3>
                                <div class="score">{{ "%.1f"|format((similarity.flow or 0) * 100) }}%</div>
                            </div>
                        </div>

                        <div class="similarity-card genre">
                            <div class="card-icon">
                                <i class="fas fa-masks-theater"></i>
                            </div>
                            <div class="card-content">
                                <h3>ì¥ë¥´ ìœ ì‚¬ë„</h3>
                                <div class="score">{{ "%.1f"|format((similarity.genre or 0) * 100) }}%</div>
                            </div>
                        </div>
                    </div>

                    <!-- íë¦„ê³¡ì„  ë¹„êµ ì°¨íŠ¸ -->
                    <div class="chart-section">
                        <h3 class="chart-title">
                            <i class="fas fa-wave-square"></i>
                            ìŠ¤í† ë¦¬ íë¦„ê³¡ì„  ë¹„êµ
                        </h3>
                        <p class="chart-description">
                            ğŸ’¡ <strong>íë¦„ê³¡ì„  ì‰½ê²Œ ì´í•´í•˜ê¸°</strong><br>
                            ì´ ê·¸ë˜í”„ëŠ” ì˜í™”ë¥¼ ë³´ëŠ” ë™ì•ˆ ëŠë¼ëŠ” ê°ì •/ê¸´ì¥ê°ì˜ ë†’ë‚®ì´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
                            <span class="description-point">ğŸ“ˆ <strong>ë†’ì„ìˆ˜ë¡:</strong> ê¸´ì¥ë˜ê³  ëª°ì…ë˜ëŠ” ì¥ë©´ (ì•¡ì…˜, í´ë¼ì´ë§¥ìŠ¤)</span><br>
                            <span class="description-point">ğŸ“‰ <strong>ë‚®ì„ìˆ˜ë¡:</strong> ì°¨ë¶„í•˜ê³  ì—¬ìœ ë¡œìš´ ì¥ë©´ (ì¼ìƒ, ëŒ€í™”)</span><br>
                            â„¹ï¸ ë¹„ìŠ·í•œ íŒ¨í„´ì˜ ì˜í™”ëŠ” ë¹„ìŠ·í•œ ê°ì •ì  ê²½í—˜ì„ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤.
                        </p>
                        <div class="chart-container">
                            <canvas id="flowChart"></canvas>
                        </div>
                        <div class="chart-actions">
                            <button class="detail-btn" onclick="toggleDetailedAnalysis()">
                                <i class="fas fa-eye"></i>
                                <span id="detailBtnText">ìì„¸íˆ ë³´ê¸°</span>
                            </button>
                        </div>
                        
                        <!-- ìì„¸í•œ êµ¬ê°„ë³„ ë¶„ì„ -->
                        <div class="detailed-analysis" id="detailedAnalysis" style="display: none;">
                            <h4 class="analysis-title">
                                <i class="fas fa-chart-line"></i>
                                êµ¬ê°„ë³„ ìƒì„¸ ë¶„ì„
                            </h4>
                            <div class="analysis-comparison">
                                <div class="analysis-column">
                                    <h5 class="movie-analysis-title">
                                        <span class="movie-color original"></span>
                                        {{ original.title }}
                                    </h5>
                                    <div class="analysis-segments">
                                        {% if original.detailed_analysis %}
                                            {% for segment in original.detailed_analysis %}
                                                <div class="segment-item">
                                                    <span class="segment-number">{{ loop.index }}</span>
                                                    <span class="segment-description">{{ segment }}</span>
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <p class="no-analysis">êµ¬ê°„ë³„ ë¶„ì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="analysis-column">
                                    <h5 class="movie-analysis-title">
                                        <span class="movie-color related"></span>
                                        {{ related.title }}
                                    </h5>
                                    <div class="analysis-segments">
                                        {% if related.detailed_analysis %}
                                            {% for segment in related.detailed_analysis %}
                                                <div class="segment-item">
                                                    <span class="segment-number">{{ loop.index }}</span>
                                                    <span class="segment-description">{{ segment }}</span>
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <p class="no-analysis">êµ¬ê°„ë³„ ë¶„ì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LLM ë¶„ì„ ì„¤ëª… -->
                {% if llm_explanation %}
                <div class="llm-explanation">
                    <h2 class="section-title">
                        <i class="fas fa-robot"></i>
                        AI ë¶„ì„ ê²°ê³¼
                    </h2>
                    <div class="explanation-content">
                        <div class="explanation-text">
                            {{ llm_explanation }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="action-buttons">
                    <button class="action-btn primary" onclick="history.back()">
                        <i class="fas fa-arrow-left"></i>
                        ëŒì•„ê°€ê¸°
                    </button>
                </div>
            </div>
        </main>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>&copy; 2025 MovieFinder. AI ê¸°ë°˜ ì˜í™” ì¶”ì²œ ì‹œìŠ¤í…œ</p>
        </footer>
    </div>

    <script>
        // íë¦„ê³¡ì„  ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('flowChart').getContext('2d');
            
            // íë¦„ê³¡ì„  ë°ì´í„° (JSONì—ì„œ ê°€ì ¸ì˜¤ê¸°) - ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
            let originalFlow = {{ original.flow_curve | tojson | safe }};
            let relatedFlow = {{ related.flow_curve | tojson | safe }};
            
            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ë”ë¯¸ ë°ì´í„° ìƒì„±
            if (!originalFlow || originalFlow === null || !Array.isArray(originalFlow)) {
                originalFlow = [3, 4, 6, 8, 7, 9, 8, 6, 4, 2];  // ê¸°ë³¸ íë¦„ê³¡ì„ 
            }
            if (!relatedFlow || relatedFlow === null || !Array.isArray(relatedFlow)) {
                relatedFlow = [2, 5, 7, 6, 8, 9, 7, 5, 3, 1];   // ê¸°ë³¸ íë¦„ê³¡ì„ 
            }
            
            // ë°ì´í„° í¬ì¸íŠ¸ ìƒì„± (0-100% ë²”ìœ„)
            const maxLength = Math.max(originalFlow.length, relatedFlow.length);
            const labels = Array.from({length: maxLength}, 
                                    (_, i) => `${Math.round((i / (maxLength - 1)) * 100)}%`);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '{{ original.title }}',
                            data: originalFlow,
                            borderColor: '#00BFFF',  // í•˜ëŠ˜ìƒ‰ (Deep Sky Blue)
                            backgroundColor: 'rgba(0, 191, 255, 0.15)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#00BFFF',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        },
                        {
                            label: '{{ related.title }}',
                            data: relatedFlow,
                            borderColor: '#FF4444',  // ë¹¨ê°„ìƒ‰ (Bright Red)
                            backgroundColor: 'rgba(255, 68, 68, 0.15)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#FF4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ìŠ¤í† ë¦¬ ì „ê°œì— ë”°ë¥¸ ê°ì •/ê¸´ì¥ë„ ë³€í™”',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#ffffff'  // ì œëª©ì„ í°ìƒ‰ìœ¼ë¡œ
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',  // ë²”ë¡€ í…ìŠ¤íŠ¸ë¥¼ í°ìƒ‰ìœ¼ë¡œ
                                font: {
                                    size: 14,
                                    weight: '600'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'ê°ì •/ê¸´ì¥ë„ (1-10)',
                                color: '#ffffff'  // Yì¶• ì œëª©ì„ í°ìƒ‰ìœ¼ë¡œ
                            },
                            ticks: {
                                color: '#ffffff'  // Yì¶• ëˆˆê¸ˆì„ í°ìƒ‰ìœ¼ë¡œ
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'  // ê·¸ë¦¬ë“œë¥¼ ì—°í•œ í°ìƒ‰ìœ¼ë¡œ
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ìŠ¤í† ë¦¬ ì§„í–‰ë¥ ',
                                color: '#ffffff'  // Xì¶• ì œëª©ì„ í°ìƒ‰ìœ¼ë¡œ
                            },
                            ticks: {
                                color: '#ffffff'  // Xì¶• ëˆˆê¸ˆì„ í°ìƒ‰ìœ¼ë¡œ
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'  // ê·¸ë¦¬ë“œë¥¼ ì—°í•œ í°ìƒ‰ìœ¼ë¡œ
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        });

        // ìì„¸í•œ ë¶„ì„ í† ê¸€
        function toggleDetailedAnalysis() {
            const detailedAnalysis = document.getElementById('detailedAnalysis');
            const btnText = document.getElementById('detailBtnText');
            const btn = document.querySelector('.detail-btn');
            
            if (detailedAnalysis.style.display === 'none') {
                detailedAnalysis.style.display = 'block';
                btnText.textContent = 'ì ‘ê¸°';
                btn.querySelector('i').className = 'fas fa-eye-slash';
            } else {
                detailedAnalysis.style.display = 'none';
                btnText.textContent = 'ìì„¸íˆ ë³´ê¸°';
                btn.querySelector('i').className = 'fas fa-eye';
            }
        }
    </script>
</body>
</html>